<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bus Transport Management</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      background: #f3f4f6;
      color: #111827;
    }

    .app-header {
      background: #111827;
      color: white;
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .app-header h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 600;
    }

    .app-header small {
      font-size: 12px;
      opacity: 0.8;
    }

    .layout {
      display: flex;
      min-height: calc(100vh - 52px);
    }

    .sidebar {
      width: 280px;
      background: #111827;
      color: white;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .sidebar-section-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      margin: 12px;
    }

    label {
      font-size: 12px;
      font-weight: 500;
      display: block;
      margin-bottom: 4px;
    }

    input, select, textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 13px;
      outline: none;
    }

    input:focus, select:focus, textarea:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.3);
    }

    textarea {
      resize: vertical;
      min-height: 50px;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-primary {
      background: #2563eb;
      color: white;
    }

    .btn-primary:hover {
      background: #1d4ed8;
    }

    .btn-secondary {
      background: #374151;
      color: white;
    }

    .btn-secondary:hover {
      background: #1f2937;
    }

    .btn-danger {
      background: #b91c1c;
      color: white;
    }

    .btn-danger:hover {
      background: #991b1b;
    }

    .btn-sm {
      padding: 4px 10px;
      font-size: 12px;
    }

    .bus-list {
      max-height: 280px;
      overflow-y: auto;
      margin-top: 6px;
      padding-right: 4px;
    }

    .bus-item {
      width: 100%;
      text-align: left;
      border-radius: 10px;
      padding: 6px 8px;
      border: none;
      margin-bottom: 6px;
      background: #1f2937;
      color: #e5e7eb;
      cursor: pointer;
      font-size: 13px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .bus-item.active {
      background: #2563eb;
      color: white;
    }

    .bus-item span {
      display: block;
    }

    .bus-item-main {
      flex: 1;
    }

    .bus-item-sub {
      font-size: 11px;
      opacity: 0.9;
    }

    .bus-item-delete {
      font-size: 10px;
      opacity: 0.8;
    }

    .main {
      flex: 1;
      padding: 12px 12px 24px;
      overflow-x: hidden;
    }

    .main-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 12px;
      margin-bottom: 10px;
      padding: 0 4px;
    }

    .main-header h2 {
      margin: 0;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .badge {
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 11px;
      background: #e5e7eb;
      color: #374151;
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 3fr);
      gap: 12px;
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    .form-actions {
      margin-top: 10px;
      display: flex;
      justify-content: flex-end;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    th, td {
      padding: 6px 8px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
      vertical-align: top;
    }

    th {
      background: #f3f4f6;
      font-weight: 600;
    }

    .table-wrapper {
      max-height: 340px;
      overflow: auto;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    .summary {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .summary-card {
      flex: 1;
      min-width: 130px;
      background: #f9fafb;
      border-radius: 10px;
      padding: 8px 10px;
    }

    .summary-label {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 2px;
    }

    .summary-value {
      font-size: 16px;
      font-weight: 600;
    }

    .summary-sub {
      font-size: 11px;
      color: #6b7280;
    }

    .empty-state {
      text-align: center;
      padding: 40px 16px;
      color: #6b7280;
      font-size: 14px;
    }

    .empty-state strong {
      color: #111827;
    }

    @media (max-width: 900px) {
      .layout {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
      }

      .sidebar > div {
        flex: 1 1 260px;
      }

      .main {
        padding: 8px;
      }

      .grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header class="app-header">
    <div>
      <h1>Bus Transport Management</h1>
      <small>Track buses, daily fuel costs, driver salary & location</small>
    </div>
  </header>

  <div class="layout">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div>
        <div class="sidebar-section-title">Add / Edit Bus</div>
        <form id="busForm">
          <div style="margin-bottom: 6px;">
            <label for="busName">Bus name / number</label>
            <input id="busName" required placeholder="e.g. Bus 1, KA 01 AB 1234">
          </div>
          <div style="margin-bottom: 6px;">
            <label for="busPlate">Vehicle number (optional)</label>
            <input id="busPlate" placeholder="e.g. KA 01 AB 1234">
          </div>
          <div style="margin-bottom: 6px;">
            <label for="busRoute">Route (optional)</label>
            <input id="busRoute" placeholder="e.g. City A → City B">
          </div>
          <div class="form-actions" style="margin-top: 8px;">
            <button type="submit" class="btn btn-primary btn-sm">Save Bus</button>
          </div>
        </form>
      </div>

      <div>
        <div class="sidebar-section-title" style="margin-top: 10px;">Buses</div>
        <div class="bus-list" id="busList"></div>
        <small style="font-size: 11px; opacity: 0.8;">Tip: Tap a bus to see and add daily records.</small>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main">
      <div class="main-header">
        <h2 id="currentBusTitle">
          No bus selected
        </h2>
        <span id="currentBusMeta" class="badge" style="display: none;"></span>
      </div>

      <div id="noBusState" class="empty-state">
        <p><strong>Add a bus</strong> on the left side to get started.</p>
        <p>Then you can record daily fuel cost, driver salary and location for each bus.</p>
      </div>

      <div id="busDetails" style="display: none;">
        <div class="grid">
          <!-- DAILY ENTRY FORM -->
          <section class="card">
            <h3 style="margin-top: 0; font-size: 15px; margin-bottom: 8px;">Add Daily Record</h3>
            <form id="recordForm">
              <div class="form-row">
                <div>
                  <label for="recordDate">Date</label>
                  <input type="date" id="recordDate" required>
                </div>
                <div>
                  <label for="recordFuel">Fuel cost</label>
                  <input type="number" step="0.01" min="0" id="recordFuel" required placeholder="₹">
                </div>
              </div>

              <div class="form-row" style="margin-top: 8px;">
                <div>
                  <label for="recordDriver">Driver name</label>
                  <input id="recordDriver" placeholder="e.g. Ramesh">
                </div>
                <div>
                  <label for="recordDriverSalary">Driver salary for the day</label>
                  <input type="number" step="0.01" min="0" id="recordDriverSalary" placeholder="₹">
                </div>
              </div>

              <div style="margin-top: 8px;">
                <label for="recordLocation">Location / Route status</label>
                <input id="recordLocation" placeholder="e.g. At Depot, On Route 1">
              </div>

              <div style="margin-top: 8px;">
                <label for="recordNotes">Notes (optional)</label>
                <textarea id="recordNotes" placeholder="Any extra information"></textarea>
              </div>

              <div class="form-actions">
                <button type="submit" class="btn btn-primary">Add Record</button>
              </div>
            </form>
          </section>

          <!-- TABLE + SUMMARY -->
          <section class="card">
            <h3 style="margin-top: 0; font-size: 15px; margin-bottom: 8px;">History & Summary</h3>

            <div class="summary" id="summary">
              <!-- Summary cards added via JS -->
            </div>

            <div class="table-wrapper" style="margin-top: 10px;">
              <table>
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Fuel Cost</th>
                    <th>Driver / Salary</th>
                    <th>Location</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody id="recordsTableBody">
                </tbody>
              </table>
            </div>
          </section>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Simple localStorage-based "database"
    var STORAGE_KEY = 'busTransportManager_v1';

    var state = {
      buses: [],     // {id, name, plate, route}
      records: [],   // {id, busId, date, fuelCost, driver, driverSalary, location, notes}
      selectedBusId: null
    };

    function loadState() {
      try {
        var raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          var parsed = JSON.parse(raw);
          if (parsed && typeof parsed === 'object') {
            state.buses = parsed.buses || [];
            state.records = parsed.records || [];
            state.selectedBusId = parsed.selectedBusId || null;
          }
        }
      } catch (e) {
        console.error('Failed to load saved data', e);
      }
    }

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function generateId(prefix) {
      return prefix + '_' +
        Math.random().toString(36).slice(2, 9) +
        '_' + (new Date()).getTime().toString(36);
    }

    // --- Rendering ---

    function renderBusList() {
      var busListEl = document.getElementById('busList');
      busListEl.innerHTML = '';

      if (state.buses.length === 0) {
        var empty = document.createElement('div');
        empty.style.fontSize = '12px';
        empty.style.opacity = '0.8';
        empty.textContent = 'No buses yet. Add your first bus above.';
        busListEl.appendChild(empty);
        return;
      }

      for (var i = 0; i < state.buses.length; i++) {
        (function () {
          var bus = state.buses[i];
          var btn = document.createElement('button');
          btn.className = 'bus-item' + (bus.id === state.selectedBusId ? ' active' : '');
          btn.type = 'button';

          var main = document.createElement('div');
          main.className = 'bus-item-main';
          var titleSpan = document.createElement('span');
          titleSpan.textContent = bus.name;
          var subSpan = document.createElement('span');
          subSpan.className = 'bus-item-sub';
          subSpan.textContent = bus.plate || bus.route || 'No extra details';
          main.appendChild(titleSpan);
          main.appendChild(subSpan);

          var delBtn = document.createElement('button');
          delBtn.type = 'button';
          delBtn.className = 'btn btn-danger btn-sm bus-item-delete';
          delBtn.textContent = '✕';

          delBtn.addEventListener('click', function (event) {
            event.stopPropagation();
            if (confirm('Delete this bus and all its records?')) {
              deleteBus(bus.id);
            }
          });

          btn.addEventListener('click', function () {
            selectBus(bus.id);
          });

          btn.appendChild(main);
          btn.appendChild(delBtn);
          busListEl.appendChild(btn);
        })();
      }
    }

    function renderCurrentBusHeader() {
      var titleEl = document.getElementById('currentBusTitle');
      var metaEl = document.getElementById('currentBusMeta');
      var noBusState = document.getElementById('noBusState');
      var details = document.getElementById('busDetails');

      var bus = null;
      for (var i = 0; i < state.buses.length; i++) {
        if (state.buses[i].id === state.selectedBusId) {
          bus = state.buses[i];
          break;
        }
      }

      if (!bus) {
        titleEl.textContent = 'No bus selected';
        metaEl.style.display = 'none';
        noBusState.style.display = 'block';
        details.style.display = 'none';
        return;
      }

      titleEl.textContent = bus.name;
      var totalRecords = 0;
      for (var j = 0; j < state.records.length; j++) {
        if (state.records[j].busId === bus.id) {
          totalRecords++;
        }
      }
      metaEl.textContent = totalRecords + ' record' + (totalRecords === 1 ? '' : 's');
      metaEl.style.display = 'inline-block';

      noBusState.style.display = 'none';
      details.style.display = 'block';
    }

    function formatCurrency(value) {
      if (value === undefined || value === null || value === '') return '-';
      var num = Number(value);
      if (isNaN(num)) return '-';
      return '₹' + num.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function renderSummary() {
      var summaryEl = document.getElementById('summary');
      summaryEl.innerHTML = '';

      var busId = state.selectedBusId;
      if (!busId) return;

      var records = [];
      for (var i = 0; i < state.records.length; i++) {
        if (state.records[i].busId === busId) {
          records.push(state.records[i]);
        }
      }

      var totalFuel = 0;
      var totalSalary = 0;
      var datesMap = {};

      for (var j = 0; j < records.length; j++) {
        var r = records[j];
        var fuel = parseFloat(r.fuelCost);
        var sal = parseFloat(r.driverSalary);
        if (!isNaN(fuel)) totalFuel += fuel;
        if (!isNaN(sal)) totalSalary += sal;
        if (r.date) datesMap[r.date] = true;
      }

      var uniqueDatesCount = 0;
      for (var d in datesMap) {
        if (datesMap.hasOwnProperty(d)) uniqueDatesCount++;
      }

      var cards = [
        {
          label: 'Total Fuel Cost',
          value: formatCurrency(totalFuel),
          sub: records.length + ' record(s)'
        },
        {
          label: 'Total Driver Salary',
          value: formatCurrency(totalSalary),
          sub: records.length + ' record(s)'
        },
        {
          label: 'Days Recorded',
          value: String(uniqueDatesCount),
          sub: 'Unique dates'
        }
      ];

      for (var k = 0; k < cards.length; k++) {
        var card = cards[k];
        var c = document.createElement('div');
        c.className = 'summary-card';

        var label = document.createElement('div');
        label.className = 'summary-label';
        label.textContent = card.label;

        var val = document.createElement('div');
        val.className = 'summary-value';
        val.textContent = card.value;

        var sub = document.createElement('div');
        sub.className = 'summary-sub';
        sub.textContent = card.sub;

        c.appendChild(label);
        c.appendChild(val);
        c.appendChild(sub);
        summaryEl.appendChild(c);
      }
    }

    function renderRecordsTable() {
      var tbody = document.getElementById('recordsTableBody');
      tbody.innerHTML = '';

      var busId = state.selectedBusId;
      if (!busId) return;

      var records = [];
      for (var i = 0; i < state.records.length; i++) {
        if (state.records[i].busId === busId) {
          records.push(state.records[i]);
        }
      }

      records.sort(function (a, b) {
        var da = a.date || '';
        var db = b.date || '';
        if (da < db) return -1;
        if (da > db) return 1;
        return 0;
      });

      if (records.length === 0) {
        var trEmpty = document.createElement('tr');
        var tdEmpty = document.createElement('td');
        tdEmpty.colSpan = 5;
        tdEmpty.style.textAlign = 'center';
        tdEmpty.style.fontSize = '12px';
        tdEmpty.style.color = '#6b7280';
        tdEmpty.textContent = 'No records yet. Add a daily record on the left.';
        trEmpty.appendChild(tdEmpty);
        tbody.appendChild(trEmpty);
        return;
      }

      for (var j = 0; j < records.length; j++) {
        var r = records[j];
        var tr = document.createElement('tr');

        var dateTd = document.createElement('td');
        dateTd.textContent = r.date || '-';

        var fuelTd = document.createElement('td');
        fuelTd.textContent = formatCurrency(r.fuelCost);

        var driverTd = document.createElement('td');
        var driverName = r.driver || '-';
        var salaryText = r.driverSalary ? formatCurrency(r.driverSalary) : '-';
        driverTd.innerHTML =
          '<div>' + driverName + '</div>' +
          '<div style="font-size:11px;color:#6b7280;">Salary: ' + salaryText + '</div>';

        var locTd = document.createElement('td');
        locTd.textContent = r.location || '-';

        var notesTd = document.createElement('td');
        notesTd.textContent = r.notes || '-';

        tr.appendChild(dateTd);
        tr.appendChild(fuelTd);
        tr.appendChild(driverTd);
        tr.appendChild(locTd);
        tr.appendChild(notesTd);

        tbody.appendChild(tr);
      }
    }

    function fullRender() {
      renderBusList();
      renderCurrentBusHeader();
      renderSummary();
      renderRecordsTable();
    }

    // --- Actions ---

    function addBus(name, plate, route) {
      var bus = {
        id: generateId('bus'),
        name: name ? name.trim() : '',
        plate: plate ? plate.trim() : '',
        route: route ? route.trim() : ''
      };
      state.buses.push(bus);
      if (!state.selectedBusId) {
        state.selectedBusId = bus.id;
      }
      saveState();
      fullRender();
    }

    function selectBus(busId) {
      state.selectedBusId = busId;
      saveState();
      fullRender();
    }

    function deleteBus(busId) {
      var newBuses = [];
      for (var i = 0; i < state.buses.length; i++) {
        if (state.buses[i].id !== busId) newBuses.push(state.buses[i]);
      }
      state.buses = newBuses;

      var newRecords = [];
      for (var j = 0; j < state.records.length; j++) {
        if (state.records[j].busId !== busId) newRecords.push(state.records[j]);
      }
      state.records = newRecords;

      if (state.selectedBusId === busId) {
        state.selectedBusId = state.buses.length > 0 ? state.buses[0].id : null;
      }
      saveState();
      fullRender();
    }

    function addRecord(data) {
      var record = {
        id: generateId('rec'),
        busId: data.busId,
        date: data.date,
        fuelCost: data.fuelCost,
        driver: data.driver,
        driverSalary: data.driverSalary,
        location: data.location,
        notes: data.notes
      };
      state.records.push(record);
      saveState();
      fullRender();
    }

    // --- Init ---

    document.addEventListener('DOMContentLoaded', function () {
      loadState();
      fullRender();

      var dateInput = document.getElementById('recordDate');
      if (dateInput) {
        var today = new Date();
        var yyyy = today.getFullYear();
        var mm = String(today.getMonth() + 1);
        if (mm.length < 2) mm = '0' + mm;
        var dd = String(today.getDate());
        if (dd.length < 2) dd = '0' + dd;
        dateInput.value = yyyy + '-' + mm + '-' + dd;
      }

      var busForm = document.getElementById('busForm');
      busForm.addEventListener('submit', function (event) {
        event.preventDefault();
        var name = document.getElementById('busName').value;
        var plate = document.getElementById('busPlate').value;
        var route = document.getElementById('busRoute').value;

        if (!name || !name.trim()) {
          alert('Please enter a bus name or number.');
          return;
        }

        addBus(name, plate, route);
        busForm.reset();
      });

      var recordForm = document.getElementById('recordForm');
      recordForm.addEventListener('submit', function (event) {
        event.preventDefault();
        var busId = state.selectedBusId;
        if (!busId) {
          alert('Please select a bus first.');
          return;
        }

        var date = document.getElementById('recordDate').value;
        var fuelCost = document.getElementById('recordFuel').value;
        var driver = document.getElementById('recordDriver').value;
        var driverSalary = document.getElementById('recordDriverSalary').value;
        var location = document.getElementById('recordLocation').value;
        var notes = document.getElementById('recordNotes').value;

        if (!date) {
          alert('Please select a date.');
          return;
        }
        if (!fuelCost) {
          alert('Please enter fuel cost.');
          return;
        }

        addRecord({
          busId: busId,
          date: date,
          fuelCost: fuelCost,
          driver: driver,
          driverSalary: driverSalary,
          location: location,
          notes: notes
        });

        recordForm.reset();
        if (dateInput) dateInput.value = date;
      });
    });
  </script>
</body>
</html>